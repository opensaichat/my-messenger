<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>My Messenger</title>

<style>
:root{
  --bg:#0b141a;
  --header:#202c33;
  --panel:#111b21;
  --accent:#25d366;
  --me:#005c4b;
  --other:#202c33;
  --text:#e9edef;
  --muted:#8696a0;
}
*{box-sizing:border-box;font-family:system-ui}
body{margin:0;background:var(--bg);color:var(--text);height:100vh}

/* HEADER */
.header{
  height:56px;
  background:var(--header);
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:600;
}

/* LOGIN */
.login{
  height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
}
.login-box{
  background:var(--panel);
  padding:20px;
  border-radius:12px;
  width:90%;
}
.login-box input,button{
  width:100%;
  padding:12px;
  margin-top:10px;
  border:none;
  border-radius:8px;
}
button{background:var(--accent);font-weight:600}

/* LIST */
.dialogs{height:calc(100vh - 56px);overflow-y:auto}
.dialog{
  display:flex;
  gap:12px;
  padding:12px;
  border-bottom:1px solid #1f2c34;
  cursor:pointer;
}
.avatar{
  width:48px;height:48px;border-radius:50%;
  background:var(--accent);color:#000;
  display:flex;align-items:center;justify-content:center;
  font-weight:700
}
.dialog-name{font-weight:600}
.dialog-last{font-size:13px;color:var(--muted)}

/* CHAT */
.chat{position:fixed;inset:0;background:var(--panel);display:none;flex-direction:column}
.chat.active{display:flex}

.chat-header{
  height:56px;background:var(--header);
  display:flex;align-items:center;gap:12px;padding:0 12px
}
.chat-header button{background:none;border:none;color:white;font-size:20px}

.messages{
  flex:1;padding:12px;overflow-y:auto;
  display:flex;flex-direction:column;gap:8px
}
.message{max-width:75%;padding:10px 12px;border-radius:8px}
.me{align-self:flex-end;background:var(--me)}
.other{align-self:flex-start;background:var(--other)}
.time{font-size:11px;color:var(--muted);text-align:right}

/* INPUT */
.input{
  height:56px;display:flex;align-items:center;
  gap:8px;padding:0 10px;background:var(--header)
}
.input input{flex:1;padding:12px;border-radius:20px;border:none}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="login" class="login">
  <div class="login-box">
    <h3>–í—Ö–æ–¥</h3>
    <input id="username" placeholder="–¢–≤–æ–π ID (–ª—é–±–æ–π)">
    <button onclick="login()">–í–æ–π—Ç–∏</button>
  </div>
</div>

<!-- CHAT LIST -->
<div id="list" style="display:none">
  <div class="header">–ß–∞—Ç—ã</div>
  <div class="dialogs" id="dialogs"></div>
</div>

<!-- CHAT -->
<div id="chat" class="chat">
  <div class="chat-header">
    <button onclick="closeChat()">‚Üê</button>
    <span id="chatName">–û–±—â–∏–π —á–∞—Ç</span>
  </div>

  <div id="messages" class="messages"></div>

  <div class="input">
    <input id="text" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ‚Ä¶">
    <button onclick="send()">‚û§</button>
  </div>
</div>

<!-- FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, push, onChildAdded } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyC4IBbK-hdKXozT63Pa5lQvT6ujtsK_PQw",
  authDomain: "my-messenger-f8a0e.firebaseapp.com",
  projectId: "my-messenger-f8a0e",
  storageBucket: "my-messenger-f8a0e.firebasestorage.app",
  messagingSenderId: "262129090001",
  appId: "1:262129090001:web:d229172347c232b2d3f4f0",
  databaseURL: "https://my-messenger-f8a0e-default-rtdb.firebaseio.com"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let user = localStorage.getItem('user');

window.login = ()=>{
  const u = username.value.trim();
  if(!u) return alert('–í–≤–µ–¥–∏—Ç–µ ID');
  localStorage.setItem('user',u);
  user=u;
  start();
}

function start(){
  document.getElementById('login').style.display='none';
  document.getElementById('list').style.display='block';
  renderDialogs();
}

if(user) start();

function renderDialogs(){
  const dialogsEl = document.getElementById("dialogs");
  dialogsEl.innerHTML = "";
  const dialog = document.createElement("div");
  dialog.className = "dialog";
  dialog.innerHTML = `
    <div class="avatar">üí¨</div>
    <div class="dialog-info">
      <div class="dialog-name">–û–±—â–∏–π —á–∞—Ç</div>
      <div class="dialog-last">–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π</div>
    </div>
  `;
  dialog.onclick = () => openChat('global');
  dialogsEl.appendChild(dialog);
}

window.openChat = (id)=>{
  document.getElementById('list').style.display = 'none';
  document.getElementById('chat').classList.add('active');
  const chatName = document.getElementById('chatName');
  chatName.textContent = "–û–±—â–∏–π —á–∞—Ç";
  const chatRef = ref(db, 'messages/' + id);
  onChildAdded(chatRef, (snap) => {
    const m = snap.val();
    const div = document.createElement("div");
    div.className = "message " + (m.user === user ? "me" : "other");
    div.innerHTML = `${m.text}<div class="time">${m.user}</div>`;
    document.getElementById("messages").appendChild(div);
    document.getElementById("messages").scrollTop = document.getElementById("messages").scrollHeight;
  });
}

window.closeChat = ()=>{
  document.getElementById('chat').classList.remove('active');
  document.getElementById('list').style.display = 'block';
}

window.send = ()=>{
  const t = document.getElementById('text').value.trim();
  if (!t) return;
  push(ref(db, 'messages/global'), { text: t, user: user });
  document.getElementById('text').value = '';
}
</script>

</body>
</html>
